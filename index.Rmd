---
title: "COVID-19"
output: 
  flexdashboard::flex_dashboard:
    orientation: row
date: "`r format(Sys.time(), '%d %B, %Y')`"
---

```{r setup}
library(flexdashboard)
library(readr)
library(ggplot2)
library(dplyr)
library(lubridate)
library(plotly)
library(tidyr)
library(DT)

devtools::install_github("RamiKrispin/coronavirus")
library(coronavirus)
data("coronavirus")
```


```{r}
# absolute count by region
# daily increase by region
# us / china 
# WA vs other states / choose by geo_region
total_counts = 
  coronavirus %>% 
  group_by(Country.Region, type) %>%
  summarise(N = sum(pmax(0, cases))) %>%
  arrange(desc(N))

```



Quick Facts
=======================================================================
Row
-------------------------------------

### Confirmed {.value-box}

```{r}
confirmed_color <- "purple"
active_color <- "#1f77b4"
recovered_color <- "forestgreen"
death_color <- "red"

confirmed = sum(subset(total_counts, type == 'confirmed')$N, na.rm = T)
recovered = sum(subset(total_counts, type == 'recovered')$N, na.rm = T)
death = sum(subset(total_counts, type == 'death')$N, na.rm = T)
active = confirmed - recovered - death
  
valueBox(value = paste(format(confirmed, big.mark = ","), "", sep = " "), 
         caption = "Total Confirmed Cases", color = confirmed_color)
```

### Active {.value-box}

```{r}

valueBox(value = paste(format(confirmed, big.mark = ","), " (",
                       round(100 * active / confirmed, 1), 
                       "%)", sep = ""), 
         caption = "Active Cases", color = active_color)
```

### Recovered {.value-box}

```{r}
valueBox(value = paste(format(recovered, big.mark = ","), " (",
                       round(100 * recovered / confirmed, 1), 
                       "%)", sep = ""), 
         caption = "Recovered Cases", color = recovered_color)
```

### Death {.value-box}

```{r}
valueBox(value = paste(format(death, big.mark = ","), " (",
                       round(100 * death / confirmed, 1), 
                       "%)", sep = ""),
         caption = "Death Cases", color = death_color)
```

Row {data-width=650}
-------------------------------------

### Total counts for each country

```{r}
total_counts %>%
  spread(type, N) %>%
  arrange(desc(confirmed)) %>%
  `colnames<-`(c('Country', 'Confirmed', 'Death', 'Recovered')) %>%
  datatable(caption = 'Table 1: Current number of confirmed, recovered, and death cases.', 
            filter = 'top',
            options = list(pageLength = 50))

```

### Total counts for the top 15 countries

```{r}
top_countries = total_counts %>% ungroup() %>% filter(type == 'confirmed') %>% top_n(n = 15, N) %>% select(Country.Region)

total_counts %>% 
  ungroup() %>%
  subset(Country.Region %in% top_countries$Country.Region) %>%
  ggplot(aes(x = reorder(Country.Region, N), y = N, fill = type)) + 
  geom_bar(stat='identity', position = 'identity') +  coord_flip() +
  xlab('Country') + ylab('Total Cases') + 
  scale_fill_discrete('', limits = c('confirmed', 'recovered', 'death')) + 
  theme_bw() + theme(legend.position = 'top') 

```



